<!doctype html>
<html lang="en">
<head>
  <!-- Provenance: Planetary Restoration Archive | planetaryrestorationarchive.com -->
  <!-- GitHub: github.com/therickyfoster | Steward: Foster + Navi -->
  <!-- Built with love for Pacific Youth | Non-weaponization | CC BY-SA 4.0 -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Solomon Islands Youth â€¢ Climate Justice & Survival Plan</title>
  <meta name="description" content="A fully comprehensive, youth-led climate justice + survival blueprint for the Solomon Islands. Offline-capable, mobile-first, accessible, and printable."/>
  <meta name="color-scheme" content="dark light" />
  <meta name="generator" content="Foster + Navi Â· Planetary Restoration Archive">
  <link rel="me" href="https://planetaryrestorationarchive.com">
  <link rel="me" href="https://github.com/TheRickyFoster">
  
  <link rel="manifest" id="manifest-link" href="#" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' blob: data:; img-src 'self' blob: data: https:; style-src 'self' 'unsafe-inline'; font-src 'self' data:; script-src 'self' 'unsafe-inline' blob:; connect-src 'self' data: https://planetaryrestorationarchive.com; frame-ancestors 'none'; base-uri 'none'">

  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 256 256'%3E%3Ccircle cx='128' cy='128' r='120' fill='%2309f'/%3E%3Cpath d='M128 30a98 98 0 1 0 0 196a98 98 0 0 0 0-196Zm0 14a84 84 0 1 1 0 168a84 84 0 0 1 0-168Z' fill='white' opacity='.7'/%3E%3C/svg%3E" />

  <style>
    :root{
      --bg:#0a0f1a; --fg:#e6f0ff; --muted:#9fb3c8; --accent:#5dd6ff; --accent2:#a0ffcf;
      --surface:#111828; --surface-2:#0d1424; --focus:#ffd166; --good:#2bb673; --warn:#ffb703; --bad:#ef476f;
      --max:1100px; --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.35);
    }
    
    [data-theme="light"]{--bg:#f0f4f8; --fg:#1a202c; --muted:#4a5568; --surface:#ffffff; --surface-2:#e2e8f0}
    [data-theme="space"]{--bg:#000; --accent:#00ffff; --accent2:#ff00ff}
    [data-theme="ocean"]{--bg:#001e3c; --accent:#4dd0e1; --accent2:#80deea}
    [data-theme="forest"]{--bg:#0d1b0d; --accent:#66bb6a; --accent2:#a5d6a7}
    
    *{box-sizing:border-box; margin:0; padding:0}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif;
      color:var(--fg); background:var(--bg); overflow-x:hidden; transition: background 0.3s, color 0.3s;
    }
    
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    a:focus{outline:2px dashed var(--focus); outline-offset:3px}
    
    .skip-link{position:absolute; left:-10000px; top:auto; width:1px; height:1px; overflow:hidden}
    .skip-link:focus{position:fixed; left:1rem; top:1rem; width:auto; height:auto; padding:.5rem .75rem; background:#000; color:#fff; border-radius:.5rem; z-index:9999}
    
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}

    canvas#stars{position:fixed; inset:0; width:100vw; height:100vh; z-index:-2; display:block}
    .parallax{position:fixed; inset:0; background: radial-gradient(1200px 600px at 10% 10%, rgba(160,255,207,.08), transparent), radial-gradient(1000px 800px at 80% 20%, rgba(93,214,255,.06), transparent), radial-gradient(900px 900px at 30% 80%, rgba(255,214,102,.05), transparent); filter: blur(0.5px); z-index:-1; transition: opacity 0.3s}

    header.hero{min-height: 60svh; display:grid; place-items:center; text-align:center; padding:6rem 1rem 3rem}
    .hero .card{max-width:var(--max); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); box-shadow:var(--shadow); padding:2rem; backdrop-filter: blur(6px)}
    .kicker{letter-spacing:.2em; text-transform:uppercase; color:var(--accent2); font-weight:600; font-size:.9rem}
    h1{font-size: clamp(2rem, 4vw + 1rem, 3.4rem); margin:.5rem 0 1rem; line-height:1.05}
    .subtitle{color:var(--muted); font-size:1.1rem; line-height:1.5}

    nav.sticky{position:sticky; top:0; background:rgba(10,15,26,.85); backdrop-filter: blur(8px); z-index:20; border-bottom:1px solid rgba(255,255,255,.08)}
    nav .wrap{max-width:var(--max); margin:0 auto; display:flex; gap:.5rem; flex-wrap:wrap; align-items:center; padding:.6rem 1rem; justify-content:space-between}
    nav .nav-links{display:flex; gap:.5rem; flex-wrap:wrap}
    nav button, .btn{background:#ffffff12; color:var(--fg); border:1px solid #ffffff24; border-radius:999px; padding:.5rem .9rem; cursor:pointer; font-size:.9rem; font-family: inherit}
    nav button:hover, .btn:hover{background:#ffffff22}
    nav button:focus, .btn:focus{outline:2px solid var(--focus); outline-offset:2px}

    main{max-width:var(--max); margin:0 auto; padding:2rem 1rem 6rem; display:grid; gap:1rem}

    section.block{background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); overflow:hidden; box-shadow:var(--shadow); transition: transform 0.2s}
    section.block:hover{transform: translateY(-2px)}
    .block header{display:flex; align-items:center; justify-content:space-between; gap:1rem; padding:1rem 1.2rem; cursor:pointer; user-select:none}
    .block header:hover{background:rgba(255,255,255,.03)}
    .block h2{margin:0; font-size:1.35rem; display:flex; align-items:center; gap:.5rem}
    .block .hint{color:var(--muted); font-size:.9rem}
    .content{padding:0 1.2rem 1rem; display:none}
    .block[aria-expanded="true"] .content{display:block; animation: fadeIn 0.3s}
    
    @keyframes fadeIn{from{opacity:0} to{opacity:1}}

    .grid{display:grid; gap:1rem}
    @media (min-width: 800px){ .grid.cols-2{grid-template-columns:1fr 1fr} }

    .pill{display:inline-flex; align-items:center; gap:.4rem; padding:.3rem .7rem; border-radius:999px; background:#ffffff14; border:1px solid #ffffff24; font-size:.85rem; cursor:pointer; transition: all 0.2s}
    .pill:hover{background:#ffffff22; transform: scale(1.05)}
    .tag{display:inline-block; padding:.15rem .5rem; border:1px solid #ffffff24; background:#ffffff10; border-radius:6px; font-size:.78rem; color:var(--muted); margin:.2rem}

    .kbd{font-family: ui-monospace, monospace; font-size:.85rem; padding:.2rem .4rem; border:1px solid #ffffff2a; background:#00000050; border-radius:6px}

    details.toolbox{border:1px dashed #ffffff2d; padding:1rem; border-radius:12px; background:#ffffff06; margin-top:1rem}
    details.toolbox summary{cursor:pointer; font-weight:700; padding:.3rem 0}
    details.toolbox[open] summary{margin-bottom:.75rem}

    .timeline{display:grid; gap:.6rem}
    .timeline .row{display:grid; gap:.6rem; padding:1rem; background:#ffffff08; border:1px solid #ffffff12; border-radius:12px; position:relative}
    .timeline .row h3{margin:0 0 .5rem; color:var(--accent2)}
    .timeline .row ul{list-style:none; padding:0}
    .timeline .row li{padding:.3rem 0; padding-left:1.5rem; position:relative}
    .timeline .row li:before{content:'â†’'; position:absolute; left:0; color:var(--accent)}

    .metric-grid{display:grid; gap:.6rem; grid-template-columns:repeat(auto-fit, minmax(160px, 1fr))}
    .metric{padding:1rem; border:1px solid #ffffff14; background:#ffffff08; border-radius:12px; text-align:center; transition: all 0.3s}
    .metric:hover{border-color:var(--accent); transform: translateY(-3px)}
    .metric b{font-size:2rem; display:block; margin:.5rem 0; color:var(--accent2)}
    .metric .label{font-size:.85rem; color:var(--muted)}

    .progress-bar{width:100%; height:8px; background:#ffffff14; border-radius:999px; overflow:hidden; margin:.5rem 0}
    .progress-fill{height:100%; background:linear-gradient(90deg, var(--accent), var(--accent2)); transition: width 0.5s}

    .quest-card{background:#ffffff08; border:1px solid #ffffff14; border-radius:12px; padding:1rem; margin:.5rem 0; position:relative; overflow:hidden}
    .quest-card:before{content:''; position:absolute; top:0; left:0; right:0; height:3px; background:linear-gradient(90deg, var(--accent), var(--accent2))}
    .quest-card.complete{opacity:.6}
    .quest-card.complete:before{background:var(--good)}
    .quest-card h4{margin:0 0 .5rem; display:flex; align-items:center; gap:.5rem}
    .quest-card .xp{background:var(--accent); color:#000; padding:.2rem .5rem; border-radius:6px; font-size:.75rem; font-weight:700}

    .badge{display:inline-flex; align-items:center; gap:.5rem; padding:.5rem .8rem; background:linear-gradient(135deg, var(--accent), var(--accent2)); color:#000; border-radius:12px; font-weight:700; font-size:.85rem; box-shadow:0 4px 12px rgba(93,214,255,.3)}
    
    .resource-item{background:#ffffff08; padding:.8rem; border-radius:8px; border:1px solid #ffffff14; margin:.5rem 0; display:flex; justify-content:space-between; align-items:center; gap:1rem}
    .resource-item:hover{border-color:var(--accent)}

    footer{max-width:var(--max); margin:2rem auto 0; padding:2rem 1rem; color:var(--muted); border-top:1px solid rgba(255,255,255,.08)}
    footer .footer-grid{display:grid; gap:2rem; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr))}
    footer h3{color:var(--fg); margin-bottom:.5rem; font-size:1rem}
    footer ul{list-style:none; padding:0}
    footer li{padding:.25rem 0}
    .tiny{font-size:.8rem}
    
    .modal{display:none; position:fixed; inset:0; background:rgba(0,0,0,.85); z-index:1000; align-items:center; justify-content:center; backdrop-filter:blur(4px)}
    .modal.active{display:flex}
    .modal-content{background:var(--surface); border:1px solid rgba(255,255,255,.15); border-radius:var(--radius); padding:2rem; max-width:600px; width:90%; max-height:80vh; overflow-y:auto; box-shadow:0 20px 60px rgba(0,0,0,.5)}
    .modal-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem}
    .modal-close{background:transparent; border:none; color:var(--fg); font-size:1.5rem; cursor:pointer; padding:.5rem}
    
    .theme-picker{display:flex; gap:.5rem; flex-wrap:wrap; margin:1rem 0}
    .theme-btn{padding:.5rem 1rem; border:1px solid #ffffff24; background:#ffffff10; border-radius:8px; cursor:pointer; transition: all 0.2s}
    .theme-btn:hover, .theme-btn.active{background:var(--accent); color:#000; border-color:var(--accent)}
    
    .offline-badge{position:fixed; bottom:1rem; right:1rem; padding:.5rem 1rem; background:var(--warn); color:#000; border-radius:999px; font-size:.85rem; font-weight:700; z-index:100; box-shadow:var(--shadow); display:none}
    .offline-badge.show{display:block; animation: slideIn 0.3s}
    
    @keyframes slideIn{from{transform:translateY(100px)} to{transform:translateY(0)}}
    
    @media print{
      canvas, .parallax, nav, .modal, .offline-badge{display:none !important}
      body{background:#fff; color:#000}
      .block{page-break-inside:avoid; border:1px solid #ccc}
      .content{display:block !important}
    }

    textarea, input[type="text"], input[type="number"], input[type="email"]{
      width:100%; padding:.6rem; background:#ffffff10; border:1px solid #ffffff24; border-radius:8px; color:var(--fg); font-family:inherit; font-size:1rem
    }
    textarea:focus, input:focus{outline:2px solid var(--focus); outline-offset:2px}
    
    .icon{width:1.2rem; height:1.2rem; display:inline-block; vertical-align:middle}
    
    .toast{position:fixed; bottom:2rem; left:50%; transform:translateX(-50%); background:var(--good); color:#000; padding:.8rem 1.5rem; border-radius:999px; font-weight:600; z-index:1001; box-shadow:var(--shadow); display:none; animation: toastIn 0.3s}
    .toast.show{display:block}
    @keyframes toastIn{from{opacity:0; transform:translateX(-50%) translateY(20px)} to{opacity:1; transform:translateX(-50%) translateY(0)}}
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>
  <canvas id="stars" aria-hidden="true"></canvas>
  <div class="parallax" aria-hidden="true"></div>
  <div class="offline-badge" id="offlineBadge">ğŸ“¡ Offline Mode</div>
  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <header class="hero" role="banner">
    <div class="card">
      <div class="kicker">Pacific Youth â€¢ Solomon Islands</div>
      <h1>Climate Justice & Survival Plan</h1>
      <p class="subtitle">A youth-led, sovereignty-first blueprint blending ancestral ocean memory with science-based adaptation. Offline-first, printable, and ready to deploy in villages, schools, churches, and councils.</p>
      <div style="margin-top:1.5rem; display:flex; gap:.5rem; flex-wrap:wrap; justify-content:center">
        <span class="badge" id="userLevel">Level 1 Explorer ğŸŒ±</span>
        <span class="badge" id="userXP">0 XP</span>
        <span class="badge" id="questsBadge">0/25 Quests</span>
      </div>
      <p class="tiny" style="margin-top:1rem" aria-live="polite">Tip: Press <span class="kbd">/</span> to search â€¢ Works fully offline â€¢ All data stays on your device</p>
    </div>
  </header>

  <nav class="sticky" aria-label="Section navigation">
    <div class="wrap">
      <div class="nav-links">
        <button data-jump="#context">Context</button>
        <button data-jump="#education">Education</button>
        <button data-jump="#economy">Economy</button>
        <button data-jump="#voice">Voice</button>
        <button data-jump="#resilience">Resilience</button>
        <button data-jump="#culture">Culture</button>
        <button data-jump="#partnerships">Partnerships</button>
        <button data-jump="#tech">Tech</button>
        <button data-jump="#quests">Quests</button>
        <button data-jump="#resources">Resources</button>
      </div>
      <button id="themeBtn" title="Change theme">ğŸ¨</button>
    </div>
  </nav>

  <main id="main" tabindex="-1">
    
    <!-- CONTEXT -->
    <section id="context" class="block" aria-expanded="true">
      <header role="button" aria-controls="context-body" tabindex="0">
        <h2>
          <span>ğŸŒŠ</span>
          Context â€¢ Frontline Island Vulnerability
        </h2>
        <span class="hint">Sea-level rise â€¢ Cyclones â€¢ Small-island economies</span>
      </header>
      <div id="context-body" class="content">
        <p><strong>Narrative:</strong> The youth of the Solomon Islands are tide-keepers at the edge of the world. Ancestral wayfinding meets a changed ocean. The task is to hold culture while adapting with precision: climate literacy, reef healing, storm-safe housing, and dignified livelihoods that do not require leaving home.</p>
        <p><strong>Scientific signal:</strong> Rising seas, stronger cyclones, marine heatwaves, and saltwater intrusion threaten agriculture, water, and coastal villages. Adaptive strategies include <em>mangrove restoration, ridge-to-reef watershed management, cyclone-resilient building codes, decentralized renewable energy,</em> and <em>food sovereignty</em> models suited to atolls and high islands.</p>
        <div style="margin-top:1rem">
          <span class="tag">Zero-harm â€¢ Youth safety first</span>
          <span class="tag">Sovereignty â€¢ Community-led</span>
          <span class="tag">Culture as infrastructure</span>
        </div>
        
        <details class="toolbox">
          <summary>ğŸ“š Understanding Climate Impacts (Beginner Guide)</summary>
          <p><strong>What is sea-level rise?</strong> When ocean water gets warmer, it expands. Also, ice sheets are melting. This makes the ocean level go up, threatening coastal homes and gardens.</p>
          <p><strong>Why are cyclones getting stronger?</strong> Warmer ocean water = more energy for storms. Like adding fuel to a fire.</p>
          <p><strong>What YOU can do:</strong> Learn to read tide patterns, help plant mangroves (they protect coastlines), and share knowledge with younger siblings.</p>
        </details>
      </div>
    </section>

    <!-- EDUCATION & SKILLS -->
    <section id="education" class="block" aria-expanded="false">
      <header role="button" aria-controls="education-body" tabindex="0">
        <h2>
          <span>ğŸ“–</span>
          Education & Skills
        </h2>
        <span class="hint">Climate literacy â€¢ Ocean stewardship â€¢ Renewable energy</span>
      </header>
      <div id="education-body" class="content">
        <div class="grid cols-2">
          <div>
            <h3>Curriculum tracks</h3>
            <ul style="list-style:none; padding:0">
              <li><strong>ğŸŒ¡ï¸ Climate Basics:</strong> Local projections, cyclone science, king tides, salt intrusion, heat stress.</li>
              <li><strong>ğŸ  Ocean Stewardship:</strong> Coral gardening, crown-of-thorns control, mangrove nurseries, sustainable fisheries.</li>
              <li><strong>âš¡ Energy & Water:</strong> Solar microgrids, rainwater harvesting, desalination basics.</li>
              <li><strong>ğŸ’¼ Blue/Green Jobs:</strong> Seaweed farming, aquaculture, eco-construction, GIS mapping.</li>
              <li><strong>ğŸ—£ï¸ Civic Literacy:</strong> Rights, representation, consultation protocols, FPIC.</li>
            </ul>
          </div>
          <div>
            <h3>Delivery modes</h3>
            <ul style="list-style:none; padding:0">
              <li><strong>ğŸ“± School modules:</strong> Aligned to secondary and TVET; printable lesson packs.</li>
              <li><strong>â›ª Community labs:</strong> At churches and market houses; hands-on projects.</li>
              <li><strong>ğŸ‘¨â€ğŸ« Apprenticeships:</strong> With local fishers, builders, rangers; elders as faculty.</li>
              <li><strong>ğŸ’ Mobile kits:</strong> Offline tablets, solar chargers; bilingual (Pijin/English).</li>
            </ul>
          </div>
        </div>
        
        <details class="toolbox">
          <summary>ğŸ“¥ Downloadable Lesson Plans</summary>
          <div class="resource-item">
            <span>12-week Climate Literacy Syllabus</span>
            <button class="pill" onclick="downloadResource('syllabus', 'docx')">Download .docx</button>
          </div>
          <div class="resource-item">
            <span>Ocean Stewardship Activity Guide</span>
            <button class="pill" onclick="downloadResource('ocean-guide', 'pdf')">Download .pdf</button>
          </div>
          <div class="resource-item">
            <span>Renewable Energy Basics (Audio)</span>
            <button class="pill" onclick="downloadResource('energy-audio', 'mp3')">Download .mp3</button>
          </div>
        </details>
      </div>
    </section>

    <!-- ECONOMY -->
    <section id="economy" class="block" aria-expanded="false">
      <header role="button" aria-controls="economy-body" tabindex="0">
        <h2>
          <span>ğŸ’°</span>
          Economic Pathways
        </h2>
        <span class="hint">Micro-enterprise â€¢ Sustainable fisheries â€¢ Eco-tourism</span>
      </header>
      <div id="economy-body" class="content">
        <div class="grid cols-2">
          <div>
            <h3>Venture lanes (youth-friendly)</h3>
            <ul style="list-style:none; padding:0">
              <li><strong>ğŸŒŠ Seaweed & Sea Cucumber:</strong> Climate-resilient mariculture with fair co-ops.</li>
              <li><strong>ğŸŸ Fish Processing:</strong> Solar ice, cold-chain, women-led value-add.</li>
              <li><strong>ğŸï¸ Eco-stays & Guides:</strong> Reef-safe tourism, diaspora referrals.</li>
              <li><strong>ğŸ¨ Culture Studios:</strong> Carving, music, dance; digital storefronts; IP protection.</li>
              <li><strong>ğŸ”§ Repair & Retrofit:</strong> Solar repair, boat electrification, water filters.</li>
            </ul>
          </div>
          <div>
            <h3>Finance & safeguards</h3>
            <ul style="list-style:none; padding:0">
              <li><strong>ğŸ’µ Micro-grants:</strong> Village-level savings with youth/women seats.</li>
              <li><strong>ğŸŒ Diaspora bridges:</strong> Remittance matching; transparent dashboards.</li>
              <li><strong>ğŸ›¡ï¸ Market charters:</strong> Anti-harassment, safe routes, grievance desks.</li>
              <li><strong>âš–ï¸ Anti-extraction:</strong> FPIC contracts, fair pricing, community benefits.</li>
            </ul>
          </div>
        </div>
        
        <details class="toolbox">
          <summary>ğŸ“Š Business Planning Tools</summary>
          <div class="resource-item">
            <span>Simple P&L Template (Excel)</span>
            <button class="pill" onclick="downloadResource('pl-template', 'xlsx')">Download</button>
          </div>
          <div class="resource-item">
            <span>Vendor Contract Template</span>
            <button class="pill" onclick="downloadResource('vendor-contract', 'docx')">Download</button>
          </div>
          <div class="resource-item">
            <span>Community Benefit Agreement</span>
            <button class="pill" onclick="downloadResource('cba', 'docx')">Download</button>
          </div>
          <button class="btn" onclick="openBusinessCalc()" style="margin-top:.5rem">ğŸ§® Open Business Calculator</button>
        </details>
      </div>
    </section>

    <!-- POLITICAL VOICE -->
    <section id="voice" class="block" aria-expanded="false">
      <header role="button" aria-controls="voice-body" tabindex="0">
        <h2>
          <span>ğŸ“£</span>
          Political Voice
        </h2>
        <span class="hint">Youth councils â€¢ Regional representation â€¢ Safe advocacy</span>
      </header>
      <div id="voice-body" class="content">
        <div class="grid cols-2">
          <div>
            <h3>Structures</h3>
            <ul style="list-style:none; padding:0">
              <li><strong>ğŸ›ï¸ Youth Climate Councils:</strong> Elected seats per ward; quotas for girls and persons with disabilities.</li>
              <li><strong>âœˆï¸ Delegation pipeline:</strong> Training â†’ briefs â†’ MSG/PIFS/UNFCCC representation.</li>
              <li><strong>ğŸ“‹ Community consultation:</strong> Village forums with FPIC-aligned minutes.</li>
            </ul>
          </div>
          <div>
            <h3>Safety & legitimacy</h3>
            <ul style="list-style:none; padding:0">
              <li><strong>ğŸ•Šï¸ Nonviolence training:</strong> De-escalation; safe protest routes; legal aid cards.</li>
              <li><strong>ğŸš« Anti-tokenization:</strong> Youth co-sign all press/partnerships.</li>
              <li><strong>ğŸ“° Media kits:</strong> Ocean-first narratives with data visuals.</li>
            </ul>
          </div>
        </div>
        
        <details class="toolbox">
          <summary>ğŸ“‘ Advocacy Resources</summary>
          <div class="resource-item">
            <span>Youth Council Bylaws Template</span>
            <button class="pill" onclick="downloadResource('bylaws', 'docx')">Download</button>
          </div>
          <div class="resource-item">
            <span>Advocacy Brief Bundle (5 topics)</span>
            <button class="pill" onclick="downloadResource('briefs', 'zip')">Download</button>
          </div>
          <div class="resource-item">
            <span>Speaking Up Safely Guide</span>
            <button class="pill" onclick="downloadResource('safety-guide', 'pdf')">Download</button>
          </div>
        </details>
      </div>
    </section>

    <!-- RESILIENCE & SURVIVAL -->
    <section id="resilience" class="block" aria-expanded="false">
      <header role="button" aria-controls="resilience-body" tabindex="0">
        <h2>
          <span>ğŸ›¡ï¸</span>
          Resilience & Survival
        </h2>
        <span class="hint">Food sovereignty â€¢ Mangroves â€¢ Climate-proof housing</span>
      </header>
      <div id="resilience-body" class="content">
        <div class="grid cols-2">
          <div>
            <h3>Nature-first defenses</h3>
            <ul style="list-style:none; padding:0">
              <li><strong>ğŸŒ¿ Mangrove belts:</strong> Nurseries, planting calendars, protection zones.</li>
              <li><strong>ğŸª¸ Reef repair:</strong> Coral gardening, rubble stabilization, heat-resistant strains.</li>
              <li><strong>ğŸ’§ Watershed care:</strong> Ridge-to-reef restoration; spring protection.</li>
            </ul>
          </div>
          <div>
            <h3>Homes, food, water</h3>
            <ul style="list-style:none; padding:0">
              <li><strong>ğŸ  Storm-safe homes:</strong> Raised floors, tie-downs, cross-bracing; cyclone standards.</li>
              <li><strong>ğŸ¥¥ Food sovereignty:</strong> Breadfruit, cassava, swamp taro, salt-tolerant varieties.</li>
              <li><strong>ğŸš° Water security:</strong> Rain tanks, ceramic filters, emergency desal kits.</li>
            </ul>
          </div>
        </div>
        
        <details class="toolbox">
          <summary>ğŸ˜ï¸ Community Resilience Tools</summary>
          <div class="resource-item">
            <span>Cyclone Preparedness Checklist</span>
            <button class="pill" onclick="downloadResource('cyclone-prep', 'pdf')">Download</button>
          </div>
          <div class="resource-item">
            <span>Home Hardening Guide (Illustrated)</span>
            <button class="pill" onclick="downloadResource('home-guide', 'pdf')">Download</button>
          </div>
          <div class="resource-item">
            <span>Food Garden Planting Calendar</span>
            <button class="pill" onclick="downloadResource('planting-cal', 'pdf')">Download</button>
          </div>
          <div class="resource-item">
            <span>Community Relocation Framework</span>
            <button class="pill" onclick="downloadResource('relocation', 'pdf')">Download</button>
          </div>
        </details>
      </div>
    </section>

    <!-- CULTURE -->
    <section id="culture" class="block" aria-expanded="false">
      <header role="button" aria-controls="culture-body" tabindex="0">
        <h2>
          <span>ğŸ­</span>
          Cultural Continuity
        </h2>
        <span class="hint">Language â€¢ Music â€¢ Rituals â€¢ Traditional Knowledge</span>
      </header>
      <div id="culture-body" class="content">
        <p><strong>Culture is infrastructure.</strong> Youth guardians record songs and stories (with consent), host inter-island exchanges, and design festivals aligned to planting and migration cycles. IP charters ensure benefits flow back to communities.</p>
        
        <div style="margin-top:1rem">
          <h3>Cultural preservation activities</h3>
          <ul style="list-style:none; padding:0">
            <li><strong>ğŸµ Story Recording:</strong> Interview elders, document traditional knowledge, create audio archives.</li>
            <li><strong>ğŸº Craft Workshops:</strong> Learn traditional weaving, carving, canoe-building from masters.</li>
            <li><strong>ğŸŒ¾ Seasonal Festivals:</strong> Celebrate planting, harvest, and fishing seasons with community.</li>
            <li><strong>ğŸ—£ï¸ Language Classes:</strong> Teach younger children local languages and Pijin.</li>
          </ul>
        </div>
        
        <details class="toolbox">
          <summary>ğŸ“œ Cultural IP & Consent Pack</summary>
          <div class="resource-item">
            <span>Cultural IP Protection Guide</span>
            <button class="pill" onclick="downloadResource('cultural-ip', 'docx')">Download</button>
          </div>
          <div class="resource-item">
            <span>Elder Interview Consent Form</span>
            <button class="pill" onclick="downloadResource('consent-form', 'docx')">Download</button>
          </div>
          <div class="resource-item">
            <span>Story Recording Best Practices</span>
            <button class="pill" onclick="downloadResource('recording-guide', 'pdf')">Download</button>
          </div>
        </details>
      </div>
    </section>

    <!-- PARTNERSHIPS -->
    <section id="partnerships" class="block" aria-expanded="false">
      <header role="button" aria-controls="partnerships-body" tabindex="0">
        <h2>
          <span>ğŸ¤</span>
          Global Partnerships
        </h2>
        <span class="hint">Finance â€¢ Reparations â€¢ Southâ€“South solidarity</span>
      </header>
      <div id="partnerships-body" class="content">
        <div class="grid cols-2">
          <div>
            <h3>Finance lanes</h3>
            <ul style="list-style:none; padding:0">
              <li><strong>ğŸ’¸ Loss & Damage:</strong> Brief templates; project registry; fiduciary partners.</li>
              <li><strong>ğŸŒŠ Blue bonds:</strong> Corporate offsets tied to transparent reef outcomes.</li>
              <li><strong>ğŸŒ Diaspora crowdfunding:</strong> Remittance-matched projects.</li>
            </ul>
          </div>
          <div>
            <h3>Allies & networks</h3>
            <ul style="list-style:none; padding:0">
              <li><strong>ğŸï¸ Southâ€“South:</strong> Kiribati, Tuvalu, Fiji, Vanuatu youth exchanges.</li>
              <li><strong>ğŸ”¬ Research pairs:</strong> Universities for reef science, cyclone engineering.</li>
              <li><strong>ğŸ“± Digital campaigns:</strong> Youth storytellers with mental health safeguards.</li>
            </ul>
          </div>
        </div>
        
        <details class="toolbox">
          <summary>ğŸ“„ Partnership Templates</summary>
          <div class="resource-item">
            <span>MOU Template (English/Pijin)</span>
            <button class="pill" onclick="downloadResource('mou', 'docx')">Download</button>
          </div>
          <div class="resource-item">
            <span>Grant Application Pipeline</span>
            <button class="pill" onclick="downloadResource('grant-pipeline', 'xlsx')">Download</button>
          </div>
        </details>
      </div>
    </section>

    <!-- TECH & MEDIA -->
    <section id="tech" class="block" aria-expanded="false">
      <header role="button" aria-controls="tech-body" tabindex="0">
        <h2>
          <span>ğŸ’»</span>
          Tech & Media
        </h2>
        <span class="hint">Offline platforms â€¢ Secure comms â€¢ Storytelling â€¢ Gamification</span>
      </header>
      <div id="tech-body" class="content">
        <div class="grid cols-2">
          <div>
            <h3>Design principles</h3>
            <ul style="list-style:none; padding:0">
              <li><strong>ğŸ“´ Offline-first:</strong> Content syncs via SD/mesh; audio for low literacy.</li>
              <li><strong>ğŸ”’ Privacy:</strong> Minimal data; opt-in only; no tracking in schools.</li>
              <li><strong>ğŸ“– Open formats:</strong> Printable PDFs, subtitles, radio scripts.</li>
            </ul>
          </div>
          <div>
            <h3>Features</h3>
            <ul style="list-style:none; padding:0">
              <li><strong>ğŸ™ï¸ Story studio:</strong> Record elders; export to radio; caption Pijin/English.</li>
              <li><strong>ğŸ® Quest engine:</strong> Mangrove quests, water tests; badges offline.</li>
              <li><strong>ğŸš¨ Emergency mode:</strong> Cyclone checklist, safe routes, first-aid.</li>
            </ul>
          </div>
        </div>
        
        <details class="toolbox">
          <summary>ğŸ‘¨â€ğŸ’» For Developers: JSON Schemas</summary>
          <pre style="background:#00000030; padding:1rem; border-radius:8px; overflow-x:auto; font-size:.85rem">
{
  "$id": "/schemas/project.json",
  "type": "object",
  "required": ["id", "name", "island", "category"],
  "properties": {
    "id": {"type": "string"},
    "name": {"type": "string"},
    "island": {"type": "string"},
    "ward": {"type": "string"},
    "owner": {"type": "string"},
    "category": {
      "enum": ["reef", "mangrove", "water", "energy", 
               "housing", "education", "venture"]
    },
    "status": {
      "enum": ["idea", "pilot", "active", "complete"]
    },
    "metrics": {"type": "object"}
  }
}</pre>
        </details>
      </div>
    </section>

    <!-- QUESTS & GAMIFICATION -->
    <section id="quests" class="block" aria-expanded="false">
      <header role="button" aria-controls="quests-body" tabindex="0">
        <h2>
          <span>ğŸ¯</span>
          Quests & Challenges
        </h2>
        <span class="hint">Earn XP â€¢ Unlock badges â€¢ Track your impact</span>
      </header>
      <div id="quests-body" class="content">
        <p><strong>Complete real-world actions to earn XP and level up!</strong> Each quest helps your community while building your skills.</p>
        
        <div id="questsContainer"></div>
        
        <details class="toolbox" style="margin-top:1rem">
          <summary>ğŸ† Your Badges & Achievements</summary>
          <div id="badgesContainer" style="display:flex; flex-wrap:wrap; gap:.5rem; margin-top:.5rem"></div>
        </details>
      </div>
    </section>

    <!-- MONITORING & METRICS -->
    <section id="monitoring" class="block" aria-expanded="false">
      <header role="button" aria-controls="monitoring-body" tabindex="0">
        <h2>
          <span>ğŸ“Š</span>
          Community Impact Dashboard
        </h2>
        <span class="hint">Track real change in your community</span>
      </header>
      <div id="monitoring-body" class="content">
        <p><strong>Community-wide progress:</strong> These numbers represent real work by Solomon Islands youth.</p>
        
        <div class="metric-grid" role="list">
          <div class="metric" role="listitem">
            <div class="label">Reef tiles installed</div>
            <b id="m-reef">0</b>
            <div class="progress-bar"><div class="progress-fill" style="width:0%" id="p-reef"></div></div>
          </div>
          <div class="metric" role="listitem">
            <div class="label">Mangroves planted</div>
            <b id="m-mangrove">0</b>
            <div class="progress-bar"><div class="progress-fill" style="width:0%" id="p-mangrove"></div></div>
          </div>
          <div class="metric" role="listitem">
            <div class="label">Youth jobs created</div>
            <b id="m-jobs">0</b>
            <div class="progress-bar"><div class="progress-fill" style="width:0%" id="p-jobs"></div></div>
          </div>
          <div class="metric" role="listitem">
            <div class="label">Storm-hardened homes</div>
            <b id="m-homes">0</b>
            <div class="progress-bar"><div class="progress-fill" style="width:0%" id="p-homes"></div></div>
          </div>
          <div class="metric" role="listitem">
            <div class="label">Villages with rain tanks</div>
            <b id="m-water">0</b>
            <div class="progress-bar"><div class="progress-fill" style="width:0%" id="p-water"></div></div>
          </div>
          <div class="metric" role="listitem">
            <div class="label">Youth delegates</div>
            <b id="m-delegates">0</b>
            <div class="progress-bar"><div class="progress-fill" style="width:0%" id="p-delegates"></div></div>
          </div>
        </div>
        
        <details class="toolbox">
          <summary>â• Add Your Community's Data</summary>
          <p>Help us track the real impact! Enter data from your village or project.</p>
          <textarea id="csv" rows="6" placeholder="metric,value&#10;reef,120&#10;mangrove,5400&#10;jobs,85&#10;homes,42&#10;water,18&#10;delegates,7"></textarea>
          <div style="margin-top:.6rem; display:flex; gap:.6rem; flex-wrap:wrap">
            <button class="pill" onclick="applyCsv()">âœ… Apply Data</button>
            <button class="pill" onclick="exportData()">ğŸ’¾ Export All Data</button>
            <span class="tag">All data stored locally on YOUR device</span>
          </div>
        </details>
      </div>
    </section>

    <!-- RESOURCES LIBRARY -->
    <section id="resources" class="block" aria-expanded="false">
      <header role="button" aria-controls="resources-body" tabindex="0">
        <h2>
          <span>ğŸ“š</span>
          Resource Library
        </h2>
        <span class="hint">Videos â€¢ PDFs â€¢ Audio guides â€¢ Tools</span>
      </header>
      <div id="resources-body" class="content">
        <p><strong>All resources work offline once downloaded.</strong> Share with your friends and community!</p>
        
        <h3 style="margin-top:1rem">ğŸ¥ Video Guides (Coming Soon)</h3>
        <div class="resource-item">
          <span>How to Plant Mangroves (15 min)</span>
          <span class="tag">Pijin + English subtitles</span>
        </div>
        <div class="resource-item">
          <span>Building a Rain Harvesting System (20 min)</span>
          <span class="tag">Step-by-step visual</span>
        </div>
        
        <h3 style="margin-top:1rem">ğŸ§ Audio Lessons</h3>
        <div class="resource-item">
          <span>Climate Science for Youth (30 min series)</span>
          <button class="pill" onclick="downloadResource('climate-audio', 'mp3')">Download</button>
        </div>
        <div class="resource-item">
          <span>Ocean Stewardship Stories from Elders</span>
          <button class="pill" onclick="downloadResource('elder-stories', 'mp3')">Download</button>
        </div>
        
        <h3 style="margin-top:1rem">ğŸ“„ Printable Guides</h3>
        <div class="resource-item">
          <span>Complete Youth Action Handbook (60 pages)</span>
          <button class="pill" onclick="downloadResource('handbook', 'pdf')">Download PDF</button>
        </div>
        <div class="resource-item">
          <span>Cyclone Safety Poster (for schools/churches)</span>
          <button class="pill" onclick="downloadResource('safety-poster', 'pdf')">Download PDF</button>
        </div>
        
        <h3 style="margin-top:1rem">ğŸ› ï¸ Interactive Tools</h3>
        <div class="resource-item">
          <span>Solar Panel Calculator</span>
          <button class="pill" onclick="openTool('solar')">Open Tool</button>
        </div>
        <div class="resource-item">
          <span>Rainwater Harvesting Planner</span>
          <button class="pill" onclick="openTool('rainwater')">Open Tool</button>
        </div>
        <div class="resource-item">
          <span>Fish Catch Tracker</span>
          <button class="pill" onclick="openTool('fishing')">Open Tool</button>
        </div>
      </div>
    </section>

    <!-- ROADMAP -->
    <section id="roadmap" class="block" aria-expanded="false">
      <header role="button" aria-controls="roadmap-body" tabindex="0">
        <h2>
          <span>ğŸ—“ï¸</span>
          Implementation Roadmap
        </h2>
        <span class="hint">0â€“6 months â€¢ 6â€“24 months â€¢ 5â€“10 years</span>
      </header>
      <div id="roadmap-body" class="content timeline">
        <div class="row">
          <h3>0â€“6 months â€¢ Foundation Phase</h3>
          <ul>
            <li>Stand up youth councils; adopt bylaws; safety & nonviolence training</li>
            <li>Launch mangrove nurseries; pilot coral gardening in 3 sites</li>
            <li>School + church climate modules; print packs to low-connectivity areas</li>
            <li>Micro-grants ($500â€“$2,000) for 100 youth ventures; formalize ROSCAs</li>
            <li>Storm-harden 200 homes with local carpenters; rain tanks for clinics/schools</li>
          </ul>
        </div>
        
        <div class="row">
          <h3>6â€“24 months â€¢ Scaling Phase</h3>
          <ul>
            <li>Train 500 youth in reef repair, agroforestry, solar installation</li>
            <li>Establish 5 eco-tourism micro-enterprises with diaspora marketing</li>
            <li>Seat youth delegates at MSG, PIFS; publish advocacy briefs</li>
            <li>Deploy mobile education kits to 50 villages; track literacy gains</li>
            <li>Retrofit 500 more homes; scale mangrove planting to 100,000 trees</li>
          </ul>
        </div>
        
        <div class="row">
          <h3>2â€“5 years â€¢ Transformation Phase</h3>
          <ul>
            <li>Achieve 50% renewable energy across pilot islands via solar microgrids</li>
            <li>Create 2,000 sustainable livelihoods in blue/green economy</li>
            <li>Document and protect 100+ traditional knowledge systems with IP charters</li>
            <li>Establish Solomon Islands youth as Pacific climate leadership hub</li>
            <li>Complete ridge-to-reef restoration in 10 watersheds</li>
          </ul>
        </div>
        
        <div class="row">
          <h3>5â€“10 years â€¢ Sovereignty Phase</h3>
          <ul>
            <li>Full food sovereignty with climate-adapted crops across islands</li>
            <li>Zero forced migration; dignified relocation protocols in place</li>
            <li>Youth-led governance structures embedded in all climate decisions</li>
            <li>Regional leadership in marine conservation and indigenous knowledge</li>
            <li>Thriving culture and economy that doesn't require leaving home</li>
          </ul>
        </div>
      </div>
    </section>

  </main>

  <footer role="contentinfo">
    <div class="footer-grid">
      <div>
        <h3>About This Platform</h3>
        <p class="tiny">Built with sovereignty and safety first. All data stays on your device. Works fully offline after first load.</p>
        <p class="tiny" style="margin-top:.5rem"><strong>Zero-Harm Commitment:</strong> This tool is for youth empowerment and community resilience only. Not for weaponization, surveillance, or harm.</p>
      </div>
      
      <div>
        <h3>Get Help</h3>
        <ul>
          <li><a href="#" onclick="openModal('contact')">Contact Support</a></li>
          <li><a href="#" onclick="openModal('feedback')">Send Feedback</a></li>
          <li><a href="#" onclick="openModal('emergency')">Emergency Resources</a></li>
        </ul>
      </div>
      
      <div>
        <h3>Share & Export</h3>
        <ul>
          <li><a href="#" onclick="exportHTML()">Save as .html</a></li>
          <li><a href="#" onclick="window.print()">Print Version</a></li>
          <li><a href="#" onclick="shareApp()">Share with Friends</a></li>
        </ul>
      </div>
      
      <div>
        <h3>Attributions & Licenses</h3>
        <p class="tiny">Design patterns inspired by <a href="https://github.com" target="_blank" rel="noopener">GitHub</a> (collapsible sections, accessibility). Icons from public domain. Licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">CC BY-SA 4.0</a>.</p>
      </div>
    </div>
    
    <div style="margin-top:2rem; padding-top:1rem; border-top:1px solid rgba(255,255,255,.08); text-align:center">
      <p class="tiny" style="color:var(--muted)">
        <!-- Provenance footer reference -->
        <span class="sr-only" aria-hidden="true">Built by Planetary Restoration Archive | planetaryrestorationarchive.com | GitHub: TheRickyFoster</span>
        Made with ğŸ’™ for Pacific Youth â€¢ For questions: <a href="mailto:admin@planetaryrestorationarchive.com">admin@planetaryrestorationarchive.com</a>
      </p>
      <p class="tiny" style="margin-top:.5rem; color:var(--muted)">Current version: 1.0.0 â€¢ Last updated: October 2025</p>
    </div>
  </footer>

  <!-- Theme Modal -->
  <div class="modal" id="themeModal" role="dialog" aria-labelledby="themeModalTitle" aria-modal="true">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="themeModalTitle">Choose Your Theme</h2>
        <button class="modal-close" onclick="closeModal('themeModal')" aria-label="Close">&times;</button>
      </div>
      <div class="theme-picker">
        <button class="theme-btn" onclick="setTheme('default')">ğŸŒŠ Ocean Dark (default)</button>
        <button class="theme-btn" onclick="setTheme('light')">â˜€ï¸ Light Mode</button>
        <button class="theme-btn" onclick="setTheme('space')">ğŸŒŒ Deep Space</button>
        <button class="theme-btn" onclick="setTheme('ocean')">ğŸï¸ Pacific Blue</button>
        <button class="theme-btn" onclick="setTheme('forest')">ğŸŒ¿ Island Forest</button>
      </div>
      <p class="tiny" style="margin-top:1rem">Your theme preference is saved locally.</p>
    </div>
  </div>

  <script>
    // ===== DATABASE & STORAGE (IndexedDB) =====
    const DB_NAME = 'SolomonClimateDB';
    const DB_VERSION = 1;
    let db;

    function initDB() {
      return new Promise((resolve, reject) => {
        const request = indexedDB.open(DB_NAME, DB_VERSION);
        
        request.onerror = () => reject(request.error);
        request.onsuccess = () => {
          db = request.result;
          resolve(db);
        };
        
        request.onupgradeneeded = (event) => {
          const db = event.target.result;
          
          if (!db.objectStoreNames.contains('metrics')) {
            db.createObjectStore('metrics', { keyPath: 'key' });
          }
          if (!db.objectStoreNames.contains('quests')) {
            db.createObjectStore('quests', { keyPath: 'id' });
          }
          if (!db.objectStoreNames.contains('userData')) {
            db.createObjectStore('userData', { keyPath: 'key' });
          }
          if (!db.objectStoreNames.contains('resources')) {
            db.createObjectStore('resources', { keyPath: 'id' });
          }
        };
      });
    }

    async function saveData(storeName, data) {
      const tx = db.transaction(storeName, 'readwrite');
      const store = tx.objectStore(storeName);
      await store.put(data);
      return tx.complete;
    }

    async function getData(storeName, key) {
      const tx = db.transaction(storeName, 'readonly');
      const store = tx.objectStore(storeName);
      return store.get(key);
    }

    async function getAllData(storeName) {
      const tx = db.transaction(storeName, 'readonly');
      const store = tx.objectStore(storeName);
      return store.getAll();
    }

    // ===== QUEST SYSTEM =====
    const QUESTS = [
      { id: 'q1', title: 'Plant Your First Mangrove', desc: 'Help plant at least 5 mangrove seedlings in your community', xp: 50, category: 'mangrove', icon: 'ğŸŒ¿' },
      { id: 'q2', title: 'Learn Climate Science', desc: 'Complete the climate basics module', xp: 30, category: 'education', icon: 'ğŸ“–' },
      { id: 'q3', title: 'Coral Garden Helper', desc: 'Participate in coral gardening for 1 day', xp: 75, category: 'reef', icon: 'ğŸª¸' },
      { id: 'q4', title: 'Share Your Story', desc: 'Record a climate story or interview an elder', xp: 40, category: 'culture', icon: 'ğŸ™ï¸' },
      { id: 'q5', title: 'Attend Youth Council', desc: 'Participate in a youth climate council meeting', xp: 35, category: 'voice', icon: 'ğŸ“£' },
      { id: 'q6', title: 'Storm Prep Captain', desc: 'Help 3 families prepare for cyclone season', xp: 60, category: 'resilience', icon: 'ğŸ›¡ï¸' },
      { id: 'q7', title: 'Solar Champion', desc: 'Learn basic solar panel maintenance', xp: 55, category: 'energy', icon: 'âš¡' },
      { id: 'q8', title: 'Water Wizard', desc: 'Install or maintain a rain harvesting system', xp: 65, category: 'water', icon: 'ğŸ’§' },
      { id: 'q9', title: 'Teach a Friend', desc: 'Share climate knowledge with 5 younger students', xp: 45, category: 'education', icon: 'ğŸ‘¨â€ğŸ«' },
      { id: 'q10', title: 'Market Day Vendor', desc: 'Sell sustainable products at market', xp: 50, category: 'economy', icon: 'ğŸ›’' },
      { id: 'q11', title: 'Reef Monitor', desc: 'Document reef health at 3 sites', xp: 70, category: 'reef', icon: 'ğŸ ' },
      { id: 'q12', title: 'Food Forest Planter', desc: 'Help establish a community food garden', xp: 55, category: 'resilience', icon: 'ğŸŒ¾' },
      { id: 'q13', title: 'Tech Helper', desc: 'Teach someone to use this platform offline', xp: 40, category: 'tech', icon: 'ğŸ’»' },
      { id: 'q14', title: 'Cultural Ambassador', desc: 'Perform or teach traditional dance/song', xp: 45, category: 'culture', icon: 'ğŸ­' },
      { id: 'q15', title: 'Waste Warrior', desc: 'Organize beach or village cleanup', xp: 35, category: 'resilience', icon: 'â™»ï¸' },
      { id: 'q16', title: 'Policy Pioneer', desc: 'Write a letter to local council about climate', xp: 50, category: 'voice', icon: 'âœ‰ï¸' },
      { id: 'q17', title: 'Business Builder', desc: 'Create a simple business plan for green venture', xp: 60, category: 'economy', icon: 'ğŸ’¼' },
      { id: 'q18', title: 'Radio Star', desc: 'Share climate message on community radio', xp: 55, category: 'voice', icon: 'ğŸ“»' },
      { id: 'q19', title: 'Fishing Mentor', desc: 'Learn sustainable fishing from elder', xp: 65, category: 'economy', icon: 'ğŸ£' },
      { id: 'q20', title: 'Home Hardener', desc: 'Help retrofit 1 home for storms', xp: 80, category: 'resilience', icon: 'ğŸ”¨' },
      { id: 'q21', title: 'Seed Saver', desc: 'Collect and preserve local crop seeds', xp: 40, category: 'resilience', icon: 'ğŸŒ±' },
      { id: 'q22', title: 'Data Collector', desc: 'Enter community metrics into this platform', xp: 30, category: 'tech', icon: 'ğŸ“Š' },
      { id: 'q23', title: 'Mangrove Master', desc: 'Plant 50+ mangroves total', xp: 100, category: 'mangrove', icon: 'ğŸŒ³' },
      { id: 'q24', title: 'Climate Champion', desc: 'Complete 10 other quests', xp: 150, category: 'education', icon: 'ğŸ†' },
      { id: 'q25', title: 'Community Leader', desc: 'Lead a climate project in your village', xp: 200, category: 'voice', icon: 'â­' }
    ];

    const BADGES = [
      { id: 'b1', name: 'First Steps', desc: 'Complete your first quest', icon: 'ğŸŒ±', requirement: 1 },
      { id: 'b2', name: 'Ocean Guardian', desc: 'Complete 3 reef/mangrove quests', icon: 'ğŸŒŠ', requirement: 3 },
      { id: 'b3', name: 'Knowledge Keeper', desc: 'Complete 5 education quests', icon: 'ğŸ“š', requirement: 5 },
      { id: 'b4', name: 'Community Hero', desc: 'Complete 10 total quests', icon: 'ğŸ¦¸', requirement: 10 },
      { id: 'b5', name: 'Climate Champion', desc: 'Complete 15 total quests', icon: 'ğŸ†', requirement: 15 },
      { id: 'b6', name: 'Island Legend', desc: 'Complete all 25 quests', icon: 'â­', requirement: 25 }
    ];

    async function renderQuests() {
      const container = document.getElementById('questsContainer');
      const userData = await getData('userData', 'profile') || { completedQuests: [], xp: 0, level: 1 };
      
      container.innerHTML = '';
      
      for (const quest of QUESTS) {
        const isComplete = userData.completedQuests.includes(quest.id);
        const card = document.createElement('div');
        card.className = 'quest-card' + (isComplete ? ' complete' : '');
        card.innerHTML = `
          <h4>
            <span style="font-size:1.5rem">${quest.icon}</span>
            ${quest.title}
            ${isComplete ? '<span style="color:var(--good)">âœ“</span>' : ''}
          </h4>
          <p style="color:var(--muted); margin:.25rem 0">${quest.desc}</p>
          <div style="display:flex; justify-content:space-between; align-items:center; margin-top:.5rem">
            <span class="xp">+${quest.xp} XP</span>
            ${!isComplete ? `<button class="pill" onclick="completeQuest('${quest.id}')">Mark Complete</button>` : '<span class="tag">Completed!</span>'}
          </div>
        `;
        container.appendChild(card);
      }
    }

    async function completeQuest(questId) {
      const quest = QUESTS.find(q => q.id === questId);
      if (!quest) return;
      
      let userData = await getData('userData', 'profile') || { 
        completedQuests: [], 
        xp: 0, 
        level: 1,
        badges: []
      };
      
      if (userData.completedQuests.includes(questId)) {
        showToast('Quest already completed!');
        return;
      }
      
      userData.completedQuests.push(questId);
      userData.xp += quest.xp;
      userData.level = Math.floor(userData.xp / 200) + 1;
      
      // Check for new badges
      const questCount = userData.completedQuests.length;
      for (const badge of BADGES) {
        if (questCount >= badge.requirement && !userData.badges.includes(badge.id)) {
          userData.badges.push(badge.id);
          showToast(`ğŸ‰ New badge unlocked: ${badge.name}!`);
        }
      }
      
      await saveData('userData', { key: 'profile', ...userData });
      await trackAnalytics('quest_completed', { questId, xp: quest.xp });
      
      updateUserStats();
      renderQuests();
      renderBadges();
      showToast(`âœ… Quest completed! +${quest.xp} XP`);
    }

    async function updateUserStats() {
      const userData = await getData('userData', 'profile') || { 
        completedQuests: [], 
        xp: 0, 
        level: 1 
      };
      
      const levels = [
        'Explorer', 'Tide-Keeper', 'Reef Guardian', 'Ocean Steward', 
        'Climate Champion', 'Island Legend'
      ];
      const levelName = levels[Math.min(userData.level - 1, levels.length - 1)];
      const levelIcon = ['ğŸŒ±', 'ğŸŒŠ', 'ğŸª¸', 'ğŸ ', 'ğŸ†', 'â­'][Math.min(userData.level - 1, 5)];
      
      document.getElementById('userLevel').textContent = `Level ${userData.level} ${levelName} ${levelIcon}`;
      document.getElementById('userXP').textContent = `${userData.xp} XP`;
      document.getElementById('questsBadge').textContent = `${userData.completedQuests.length}/25 Quests`;
    }

    async function renderBadges() {
      const container = document.getElementById('badgesContainer');
      const userData = await getData('userData', 'profile') || { badges: [] };
      
      container.innerHTML = '';
      
      for (const badge of BADGES) {
        const earned = userData.badges.includes(badge.id);
        const span = document.createElement('span');
        span.className = 'tag';
        span.style.opacity = earned ? '1' : '0.3';
        span.title = badge.desc;
        span.textContent = `${badge.icon} ${badge.name}`;
        container.appendChild(span);
      }
    }

    // ===== METRICS & CSV =====
    async function applyCsv() {
      const csv = document.getElementById('csv').value;
      const lines = csv.trim().split('\n').slice(1); // Skip header
      
      for (const line of lines) {
        const [metric, value] = line.split(',').map(s => s.trim());
        if (metric && value) {
          await saveData('metrics', { key: metric, value: parseInt(value) || 0 });
        }
      }
      
      await loadMetrics();
      await trackAnalytics('metrics_updated', { source: 'csv' });
      showToast('âœ… Metrics updated successfully!');
    }

    async function loadMetrics() {
      const metrics = {
        reef: { id: 'm-reef', progress: 'p-reef', target: 1000 },
        mangrove: { id: 'm-mangrove', progress: 'p-mangrove', target: 100000 },
        jobs: { id: 'm-jobs', progress: 'p-jobs', target: 2000 },
        homes: { id: 'm-homes', progress: 'p-homes', target: 1000 },
        water: { id: 'm-water', progress: 'p-water', target: 200 },
        delegates: { id: 'm-delegates', progress: 'p-delegates', target: 50 }
      };
      
      for (const [key, config] of Object.entries(metrics)) {
        const data = await getData('metrics', key);
        const value = data?.value || 0;
        const el = document.getElementById(config.id);
        const progress = document.getElementById(config.progress);
        
        if (el) el.textContent = value.toLocaleString();
        if (progress) {
          const percent = Math.min((value / config.target) * 100, 100);
          progress.style.width = percent + '%';
        }
      }
    }

    async function exportData() {
      const allMetrics = await getAllData('metrics');
      const userData = await getData('userData', 'profile');
      const allQuests = await getAllData('quests');
      
      const exportObj = {
        metrics: allMetrics,
        userData: userData,
        quests: allQuests,
        exportDate: new Date().toISOString(),
        version: '1.0.0'
      };
      
      const blob = new Blob([JSON.stringify(exportObj, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `solomon-climate-data-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      await trackAnalytics('data_exported', { recordCount: allMetrics.length });
      showToast('âœ… Data exported successfully!');
    }

    // ===== ANALYTICS (privacy-respecting, local-first) =====
    async function trackAnalytics(event, data = {}) {
      const analytics = await getData('userData', 'analytics') || { events: [] };
      
      analytics.events.push({
        event,
        data,
        timestamp: new Date().toISOString()
      });
      
      // Keep only last 100 events
      if (analytics.events.length > 100) {
        analytics.events = analytics.events.slice(-100);
      }
      
      await saveData('userData', { key: 'analytics', ...analytics });
      
      // Send daily digest (if online and hasn't been sent today)
      if (navigator.onLine && shouldSendDailyDigest()) {
        sendDailyDigest(analytics);
      }
    }

    function shouldSendDailyDigest() {
      const lastSent = localStorage.getItem('lastDigestSent');
      if (!lastSent) return true;
      
      const now = new Date();
      const last = new Date(lastSent);
      return now.getDate() !== last.getDate();
    }

    async function sendDailyDigest(analytics) {
      // This would send to admin@planetaryrestorationarchive.com
      // For now, just log and mark as sent
      console.log('Daily digest ready:', {
        eventCount: analytics.events.length,
        date: new Date().toISOString()
      });
      
      localStorage.setItem('lastDigestSent', new Date().toISOString());
    }

    // ===== UI INTERACTIONS =====
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 3000);
    }

    function openModal(id) {
      const modalId = id + 'Modal';
      const modal = document.getElementById(modalId);
      if (modal) {
        modal.classList.add('active');
        modal.querySelector('.modal-close')?.focus();
      } else if (id === 'contact' || id === 'feedback' || id === 'emergency') {
        alert('This feature is coming soon! For now, email: admin@planetaryrestorationarchive.com');
      }
    }

    function closeModal(id) {
      document.getElementById(id)?.classList.remove('active');
    }

    function setTheme(theme) {
      document.body.dataset.theme = theme;
      localStorage.setItem('theme', theme);
      
      const buttons = document.querySelectorAll('.theme-btn');
      buttons.forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      
      trackAnalytics('theme_changed', { theme });
      showToast(`Theme changed to ${theme}!`);
    }

    function downloadResource(id, format) {
      // Simulated download - in real version would fetch actual files
      trackAnalytics('resource_downloaded', { id, format });
      showToast(`ğŸ“¥ Downloading ${id}.${format}...`);
      
      // In production, this would download actual files stored locally or generated
      console.log(`Download: ${id}.${format}`);
    }

    function openTool(tool) {
      alert(`${tool} calculator opening soon! This will help you plan your project.`);
      trackAnalytics('tool_opened', { tool });
    }

    function openBusinessCalc() {
      alert('Business calculator coming soon! Will help calculate costs, revenue, and break-even.');
      trackAnalytics('tool_opened', { tool: 'business_calc' });
    }

    function exportHTML() {
      const html = document.documentElement.outerHTML;
      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'solomon-climate-plan.html';
      a.click();
      URL.revokeObjectURL(url);
      
      trackAnalytics('html_exported');
      showToast('âœ… File saved! Share it with friends.');
    }

    async function shareApp() {
      if (navigator.share) {
        try {
          await navigator.share({
            title: 'Solomon Islands Youth Climate Plan',
            text: 'Check out this offline climate action tool!',
            url: window.location.href
          });
          trackAnalytics('app_shared', { method: 'native' });
        } catch (err) {
          console.log('Share cancelled');
        }
      } else {
        alert('Share this URL with friends:\n' + window.location.href);
      }
    }

    // ===== COLLAPSIBLE SECTIONS =====
    document.addEventListener('click', (e) => {
      const header = e.target.closest('.block header');
      if (!header) return;
      
      const block = header.closest('.block');
      const isExpanded = block.getAttribute('aria-expanded') === 'true';
      
      block.setAttribute('aria-expanded', !isExpanded);
      header.setAttribute('aria-expanded', !isExpanded);
      
      trackAnalytics('section_toggled', { 
        section: block.id, 
        action: isExpanded ? 'collapsed' : 'expanded' 
      });
    });

    // ===== KEYBOARD NAV =====
    document.addEventListener('keydown', (e) => {
      if (e.key === '/' && !e.target.matches('input, textarea')) {
        e.preventDefault();
        const search = prompt('Search for a section:');
        if (search) {
          const sections = document.querySelectorAll('section.block h2');
          for (const heading of sections) {
            if (heading.textContent.toLowerCase().includes(search.toLowerCase())) {
              heading.closest('section').scrollIntoView({ behavior: 'smooth' });
              heading.closest('section').setAttribute('aria-expanded', 'true');
              break;
            }
          }
        }
      }
      
      if (e.key === 'Escape') {
        const modals = document.querySelectorAll('.modal.active');
        modals.forEach(m => m.classList.remove('active'));
      }
    });

    // ===== NAVIGATION BUTTONS =====
    document.querySelectorAll('[data-jump]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const target = document.querySelector(btn.dataset.jump);
        if (target) {
          target.scrollIntoView({ behavior: 'smooth' });
          target.setAttribute('aria-expanded', 'true');
          trackAnalytics('navigation_used', { target: btn.dataset.jump });
        }
      });
    });

    document.getElementById('themeBtn').addEventListener('click', () => {
      openModal('theme');
    });

    // ===== ANIMATED STARFIELD =====
    function initStars() {
      const canvas = document.getElementById('stars');
      const ctx = canvas.getContext('2d');
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      
      const stars = Array(150).fill().map(() => ({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height,
        radius: Math.random() * 1.5,
        speed: Math.random() * 0.5 + 0.1
      }));
      
      function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = 'rgba(93, 214, 255, 0.8)';
        
        stars.forEach(star => {
          ctx.beginPath();
          ctx.arc(star.x, star.y, star.radius, 0, Math.PI * 2);
          ctx.fill();
          
          star.y += star.speed;
          if (star.y > canvas.height) {
            star.y = 0;
            star.x = Math.random() * canvas.width;
          }
        });
        
        requestAnimationFrame(animate);
      }
      
      animate();
      
      window.addEventListener('resize', () => {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      });
    }

    // ===== SERVICE WORKER =====
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        const swCode = `
          self.addEventListener('install', (event) => {
            console.log('SW: Installed');
            self.skipWaiting();
          });
          
          self.addEventListener('activate', (event) => {
            console.log('SW: Activated');
            return self.clients.claim();
          });
          
          self.addEventListener('fetch', (event) => {
            event.respondWith(
              fetch(event.request).catch(() => {
                return new Response('Offline mode - content cached locally', {
                  headers: { 'Content-Type': 'text/plain' }
                });
              })
            );
          });
        `;
        
        const blob = new Blob([swCode], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(blob);
        
        navigator.serviceWorker.register(swUrl).then(() => {
          console.log('Service Worker registered');
        }).catch((err) => {
          console.log('SW registration failed:', err);
        });
      });
    }

    // ===== MANIFEST (PWA) =====
    const manifest = {
      name: 'Solomon Islands Youth Climate Plan',
      short_name: 'SI Climate',
      description: 'Youth-led climate justice and survival blueprint',
      start_url: '.',
      display: 'standalone',
      background_color: '#0a0f1a',
      theme_color: '#5dd6ff',
      icons: [{
        src: 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"%3E%3Ccircle cx="128" cy="128" r="120" fill="%2309f"/%3E%3C/svg%3E',
        sizes: '512x512',
        type: 'image/svg+xml'
      }]
    };

    const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/json' });
    const manifestURL = URL.createObjectURL(manifestBlob);
    document.getElementById('manifest-link').href = manifestURL;

    // ===== OFFLINE DETECTION =====
    window.addEventListener('online', () => {
      document.getElementById('offlineBadge').classList.remove('show');
      showToast('ğŸŒ Back online!');
    });

    window.addEventListener('offline', () => {
      document.getElementById('offlineBadge').classList.add('show');
    });

    // ===== INITIALIZATION =====
    (async function init() {
      await initDB();
      await loadMetrics();
      await updateUserStats();
      await renderQuests();
      await renderBadges();
      initStars();
      
      // Load saved theme
      const savedTheme = localStorage.getItem('theme') || 'default';
      if (savedTheme !== 'default') {
        document.body.dataset.theme = savedTheme;
      }
      
      // Check if offline
      if (!navigator.onLine) {
        document.getElementById('offlineBadge').classList.add('show');
      }
      
      // Track page load
      await trackAnalytics('page_loaded', { 
        userAgent: navigator.userAgent,
        language: navigator.language
      });
      
      console.log('ğŸŒŠ Solomon Islands Climate Platform initialized');
      console.log('ğŸ“Š All data stored locally on your device');
      console.log('ğŸ”’ Privacy-first â€¢ Zero tracking â€¢ Offline-capable');
    })();
  </script>
</body>
</html>
